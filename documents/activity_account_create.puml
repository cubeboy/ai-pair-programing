@startuml Activity Diagram - Create Account

!theme plain
title 회계 관리 솔루션 - 계정과목 생성 액티비티 다이어그램

|Client|
start
:계정과목 생성 요청;
:CreateAccountRequest 전송;

|AccountController|
:요청 수신;
:CreateAccountCommand 생성;

|AccountService|
:계정코드 중복 검사;

if (계정코드 중복?) then (yes)
    |Client|
    :400 Bad Request 응답\n"계정코드 이미 존재";
    stop
else (no)
    |AccountService|
    if (상위계정 지정?) then (yes)
        :상위계정 조회;
        if (상위계정 존재?) then (no)
            |Client|
            :400 Bad Request 응답\n"상위계정 없음";
            stop
        else (yes)
            if (상위계정 활성?) then (no)
                |Client|
                :400 Bad Request 응답\n"비활성 상위계정";
                stop
            endif
        endif
    endif
    
    :Account 도메인 객체 생성;
    note right
        - AccountId(0) - 자동 생성
        - code, name, type 설정
        - parentId 설정 (선택적)
        - isActive = true
        - 생성일시 설정
    end note
    
    |AccountRepositoryImpl|
    :도메인 객체를 JPA 엔티티로 변환;
    
    |Database|
    :계정과목 저장;
    :ID 자동 생성;
    
    |AccountRepositoryImpl|
    :저장된 엔티티를 도메인 객체로 변환;
    
    |AccountController|
    :Account를 AccountResponse로 변환;
    
    |Client|
    :201 Created 응답\n(AccountResponse);
endif

stop

@enduml
